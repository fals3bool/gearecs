<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FalsECS - Scene Manager</title>
    <link href="../css/style.css" rel="stylesheet">
  </head>

  <body>
    <table>
      <tr class="falsecs-example">
        <td>
          <div id="canvas-container">
            <canvas id="canvas"></canvas>
          </div>
        </td>
      </tr>

      <tr class="falsecs-docs">
        <td>
          <h2>Scene Manager</h2>

          <p>
          FalsECS <b>Scene Manager</b> creates, deletes and modifies scenes (registries). <br>
          It also register default components and systems as seen before. <br><br>
          It has a main loop function available for desktop and web games. <br>
          The main loop executes each system at their specified execution layer. <br>
          It has access to the window and camera but they are not defined by the Scene Manager. <br><br>
          There is a new function <b><i>Entity ecs_entity_wdata(Scene *s)</i></b> that creates an Entity <br>
          with an <b>EntityData</b> component {visible and enabled}.
          </p>

          <h2>Example</h2>

          <pre><code class="language-c">
#include &lt;scene/manager.h&gt;
#include &lt;math.h&gt;

#define SCREEN_W 800
#define SCREEN_H 450
void load_own_entities(Scene *sc);

typedef struct {
  float x;
  float y;
} PositionF;

typedef struct {
  float magnitude;
} Speed;

void move_system(Registry *r, Entity e) {
  PositionF *p = ecs_get(r, e, PositionF);
  Speed *sp = ecs_get(r, e, Speed);
  if (fabs(p->x) > 350)
    sp->magnitude = -sp->magnitude;
  p->x += sp->magnitude * GetFrameTime();
}

void draw_system(Registry *r, Entity e) {
  PositionF *p = ecs_get(r, e, PositionF);
  Rectangle rec = {p->x - 16, p->y, 32, 32};
  DrawRectangleRec(rec, RED);
}

int main(void) {

  // Window and Camera are created and modified outside the scene manager.
  InitWindow(SCREEN_W, SCREEN_H, "scene manager usage");
  Camera2D cam = {{SCREEN_W / 2.f, SCREEN_H / 2.f}, {0, 0}, 0, 1.f};
  Color bg = {0, 0, 0, 255};

  // Start the scene manager.
  FalsECS falsecs = falsecs_start(bg);

  // Create scene (Scene is the same as Registry).
  Scene *sc = falsecs_scene(&falsecs, cam);

  load_own_entities(sc); // The same as seen before

  // The main loop runs all systems under their execution layer.
  falsecs_loop(&falsecs);

  // When the main loop stops, the scene needs to be freed.
  falsecs_clean(&falsecs);

  CloseWindow();

  return 0;
}

void load_own_entities(Scene *sc) {
  ecs_component(sc, PositionF);
  ecs_component(sc, Speed);

  ecs_system(sc, EcsOnUpdate, move_system, PositionF);
  ecs_system(sc, EcsOnRender, draw_system, PositionF);

  Entity e = ecs_entity(sc);
  ecs_add(sc, e, PositionF, {20});
  ecs_add(sc, e, Speed, {200});
}
          </code></pre>

        </td>
      </tr>
    </table>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/c.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>

    <script>
      var Module = {
        canvas: document.getElementById('canvas')
      };
    </script>

    <script src="scene_manager.js"></script>

  </body>

</html>


